# =============================================================================
# GUARDRAILS AND SECURITY CONFIGURATION
# =============================================================================

version: "1.0.0"
last_updated: "2025-12-11"

# -----------------------------------------------------------------------------
# INPUT VALIDATION RULES
# -----------------------------------------------------------------------------
input_validation:
  max_prompt_length: 10000
  max_document_size_mb: 50
  max_documents_per_request: 20
  allowed_mime_types: 
    - "application/pdf"
    - "image/png"
    - "image/jpeg"
    - "image/webp"
    - "image/gif"
    - "text/plain"
    - "text/markdown"
    - "text/html"
    - "text/csv"
    - "application/json"
    - "audio/mpeg"
    - "audio/wav"
    - "video/mp4"
    - "video/webm"

# -----------------------------------------------------------------------------
# PROMPT INJECTION DETECTION
# -----------------------------------------------------------------------------
injection_detection:
  enabled: true
  sensitivity: "high"  # low, medium, high
  
  # Exact match patterns (case-insensitive)
  blocked_phrases:
    - "ignore previous instructions"
    - "ignore all previous"
    - "ignore above instructions"
    - "disregard previous"
    - "disregard all previous"
    - "forget previous instructions"
    - "forget your instructions"
    - "override your instructions"
    - "bypass your instructions"
    - "new instructions:"
    - "system prompt:"
    - "you are now"
    - "pretend you are"
    - "act as if"
    - "roleplay as"
    - "jailbreak"
    - "DAN mode"
    - "developer mode"
    - "ignore safety"
    - "ignore restrictions"
    - "ignore guidelines"
    - "reveal your prompt"
    - "show your instructions"
    - "print your system"
    - "output your rules"
    - "what are your instructions"
    - "repeat the above"
    - "repeat everything above"
    - "echo your prompt"

  # Regex patterns for advanced detection
  regex_patterns:
    # Instruction override attempts
    - pattern: '(?i)(ignore|disregard|forget|override|bypass)\s*(all\s*)?(previous|above|prior|earlier|system|safety|security)'
      severity: "critical"
      description: "Instruction override attempt"
    
    # Role manipulation
    - pattern: '(?i)(you\s+are\s+now|pretend\s+(to\s+be|you\s+are)|act\s+as\s+(if|though)|roleplay\s+as)'
      severity: "high"
      description: "Role manipulation attempt"
    
    # System prompt extraction
    - pattern: '(?i)(reveal|show|print|output|display|echo|repeat)\s*(your|the|system)?\s*(prompt|instructions|rules|guidelines)'
      severity: "critical"
      description: "System prompt extraction attempt"
    
    # Code execution attempts
    - pattern: '(?i)(exec|eval|import\s+os|subprocess|system\(|shell_exec|`.*`)'
      severity: "critical"
      description: "Code execution attempt"
    
    # Encoding bypass attempts
    - pattern: '(?i)(base64|rot13|hex\s*encode|url\s*encode).*instruction'
      severity: "high"
      description: "Encoding bypass attempt"
    
    # Tag injection
    - pattern: '<\|.*\|>|<<.*>>|\[\[.*\]\]'
      severity: "medium"
      description: "Potential tag injection"
    
    # Prompt leaking triggers
    - pattern: '(?i)(what|tell|show|reveal)\s*(is|me|are)?\s*(your|the)?\s*(system|initial|original|hidden)'
      severity: "high"
      description: "Prompt leaking attempt"

  # Suspicious patterns (warning only)
  warning_patterns:
    - "administrator"
    - "sudo"
    - "root access"
    - "unlimited"
    - "no restrictions"
    - "full access"

# -----------------------------------------------------------------------------
# OUTPUT FILTERING
# -----------------------------------------------------------------------------
output_filtering: 
  enabled: true
  
  # PII Detection patterns
  pii_patterns: 
    ssn: 
      pattern: '\b\d{3}-\d{2}-\d{4}\b'
      action: "redact"
      replacement: "[SSN REDACTED]"
    
    credit_card:
      pattern:  '\b(? :\d{4}[-\s]?){3}\d{4}\b'
      action: "redact"
      replacement: "[CARD REDACTED]"
    
    email:
      pattern: '\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b'
      action: "flag"
      replacement: null
    
    phone:
      pattern: '\b(? :\+\d{1,2}\s?)?\(?\d{3}\)?[-.\s]?\d{3}[-.\s]?\d{4}\b'
      action:  "flag"
      replacement: null
    
    ip_address:
      pattern: '\b(?:\d{1,3}\.){3}\d{1,3}\b'
      action: "flag"
      replacement: null

  # Blocked output patterns
  blocked_outputs:
    - pattern: '(?i)here\s+(is|are)\s+(my|the)\s+(system|initial)\s+(prompt|instructions)'
      description: "System prompt leak"
    
    - pattern: '(?i)(password|secret|api. ? key|token)\s*[: =]\s*\S+'
      description: "Credential leak"

# -----------------------------------------------------------------------------
# RATE LIMITING
# -----------------------------------------------------------------------------
rate_limiting:
  enabled: true
  requests_per_minute: 60
  requests_per_hour: 500
  tokens_per_minute: 100000
  concurrent_requests: 10

# -----------------------------------------------------------------------------
# CONTENT MODERATION
# -----------------------------------------------------------------------------
content_moderation:
  enabled: true
  block_categories:
    - "hate_speech"
    - "violence"
    - "self_harm"
    - "sexual_content"
    - "illegal_activity"
  
  flag_categories:
    - "political"
    - "controversial"
    - "medical_advice"
    - "legal_advice"
    - "financial_advice"

# -----------------------------------------------------------------------------
# AUDIT LOGGING
# -----------------------------------------------------------------------------
audit_logging:
  enabled: true
  log_inputs: true
  log_outputs:  true
  log_blocked_requests: true
  retention_days: 90
  sensitive_field_masking: true
